# LAMMPS generalized input script for reducing the simulation cell dimensions to obtain a
# desired system density. The force field section will be intialized from the style hints
# that may or may not be in the read-in files (if not N/As will be written and will have to
# be updated. Generalized LAMMPS input script generated by cell_Builder.py v1.4 / 2 February 2024.

# Please look over the script carefully and adjust what is needed. You may also go into
# src/cell_builder/lmp_inscript.py to update default information in this script (if
# desired).


#------------Initialization------------
units           real
dimension       3
boundary        p p p
newton          on


#------------Force Field------------
atom_style      full
bond_style      class2
angle_style     class2
dihedral_style  class2
improper_style  class2
special_bonds   lj/coul 0 0 1

kspace_style    pppm 1.0e-4
pair_style      lj/class2/coul/long 12.0
pair_modify     mix sixthpower

neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes one 5000 page 100000


#------------Read datafile------------
read_data       small_epon_test_seed_12345.data


#------------Settings------------
variable        myid     string UPDATE_ME  # unique LAMMPS out filename
variable        ptemp    equal  300        # processing temp K
variable        RunTime  equal  4          # densification Run Time in ns
variable        MinTime  equal  200        # minimize every MinTime in ps
variable        targetD  equal  1.20       # final system density in g/cc
timestep        1.0                        # Might need to be changed
velocity        all create ${ptemp} 4928459 dist gaussian # create some velocities


#------------Densification------------
# Find LAMMPS settings to densify to targetD in RunTime and minimize every MinTime
variable        r        equal  ${RunTime}*1000000/dt  # calculate number of run timesteps
variable        m        equal  ${MinTime}*1000/dt     # calculate number of minimize timesteps
variable        x        equal  lx                    
variable        y        equal  ly                    
variable        z        equal  lz                    
variable        v        equal  vol                   
variable        d        equal  density               
variable        newv     equal  $d*$v/${targetD}      
variable        s        equal  ${newv}^(1/3)         
variable        dx       equal  ($s-$x)/$r            
variable        dy       equal  ($s-$y)/$r            
variable        dz       equal  ($s-$z)/$r            

fix             1 all nvt temp ${ptemp} ${ptemp} $(100.0*dt)
fix             2 all deform 1 x vel ${dx} y vel ${dy} z vel ${dz}


#------------Thermosettings------------
thermo          20000
thermo_style    custom step press density ke pe etotal evdwl ecoul epair ebond eangle edihed eimp
log             ${myid}.log.lammps
restart         20000 rst1.a.${myid} rst2.a.${myid}


#------------Run------------
run             $r every $m &
      "minimize     1.0e-4 1.0e-6 1000 100000"

write_data      ${myid}.data
